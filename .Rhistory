new_dat <- expand.grid(
Group = levels(dataset_parametric$Group_age),
survival = seq(.01, .99, by = .01)
) %>%
mutate(
pred = map2(Group, survival,
~predict(parametric_model_age, type = "quantile", p = 1 - .y, se = TRUE,
newdata = data.frame(Group = .x))),
t = map_dbl(pred, ~pluck(.x, "fit")),
se = map_dbl(pred, ~pluck(.x, "se.fit")),
ucl = t + 1.96 * se,
lcl = t - 1.96 * se
)
new_dat <- expand.grid(
Group_age = levels(dataset_parametric$Group_age),
survival = seq(.01, .99, by = .01)
) %>%
mutate(
pred = map2(Group_age, survival,
~predict(parametric_model_age, type = "quantile", p = 1 - .y, se = TRUE,
newdata = data.frame(Group_age = .x))),
t = map_dbl(pred, ~pluck(.x, "fit")),
se = map_dbl(pred, ~pluck(.x, "se.fit")),
ucl = t + 1.96 * se,
lcl = t - 1.96 * se
)
palette_sex <- c("#E7B800", "#2E9FDF")
names(palette_sex) <- c("Male", "Female")
new_dat %>%
ggplot(aes(y = survival)) +
geom_line(aes(x = t, color = sex)) +
geom_ribbon(aes(xmin = lcl, xmax = ucl, fill = sex), alpha = 0.2) +
scale_color_manual(values = palette_sex) +
scale_fill_manual(values = palette_sex) +
theme_light()
new_dat %>%
ggplot(aes(y = survival)) +
geom_line(aes(x = t, color = sex)) +
geom_ribbon(aes(xmin = lcl, xmax = ucl, fill = Group_age), alpha = 0.2) +
scale_color_manual(values = palette_sex) +
scale_fill_manual(values = palette_sex) +
theme_light()
new_dat %>%
ggplot(aes(y = survival)) +
geom_line(aes(x = t, color = Group_age)) +
geom_ribbon(aes(xmin = lcl, xmax = ucl, fill = Group_age), alpha = 0.2) +
scale_color_manual(values = palette_sex) +
scale_fill_manual(values = palette_sex) +
theme_light()
new_dat %>%
ggplot(aes(y = survival)) +
geom_line(aes(x = t, color = Group_age)) +
geom_ribbon(aes(xmin = lcl, xmax = ucl, fill = Group_age), alpha = 0.2) +
scale_color_manual(values = palette_sex) +
scale_fill_manual(values = palette_sex) +
theme_light()
plot(df_km_group,  main = "Figura 9: Estimación paramétrica (distribución de Gompertz) \n y no-paramétrica de las curvas de supervivencia \n diferenciadas según el sexo", xlab = "Tiempo",
ylab = "Probabilidad de Supervivencia", col = c("red", "deepskyblue"))
lines(parametric_model_age$flex[[1]], ci = FALSE,   col = "red")
lines(parametric_model_age$flex[[2]], ci = FALSE,   col = "deepskyblue")
parametric_model_age <- flexsurvreg(Surv(t_UCI, d) ~ 1, data = dataset, dist = "gompertz") %>% summary(type = "survival") %>% data.frame
df_km_group <-  survfit(Surv(t_UCI, d) ~ Group, data = dataset_parametric)
parametric_model_age = dataset %>% group_by(Group_age) %>% do(flex = flexsurvreg(Surv(t_UCI, d) ~ 1, data = ., dist = "gompertz"))
parametric_model_age = dataset_parametric %>% group_by(Group_age) %>% do(flex = flexsurvreg(Surv(t_UCI, d) ~ 1, data = ., dist = "gompertz"))
df_km_group <-  survfit(Surv(t_UCI, d) ~ Group, data = dataset_parametric)
plot(df_km_group,  main = "Figura 9: Estimación paramétrica (distribución de Gompertz) \n y no-paramétrica de las curvas de supervivencia \n diferenciadas según el sexo", xlab = "Tiempo",
ylab = "Probabilidad de Supervivencia", col = c("red", "deepskyblue"))
lines(parametric_model_age$flex[[1]], ci = FALSE,   col = "red")
lines(parametric_model_age$flex[[2]], ci = FALSE,   col = "deepskyblue")
lines(parametric_model_age$flex[[2]], ci = TRUE,   col = "deepskyblue")
plot(df_km_group,  main = "Figura 9: Estimación paramétrica (distribución de Gompertz) \n y no-paramétrica de las curvas de supervivencia \n diferenciadas según el sexo", xlab = "Tiempo",
ylab = "Probabilidad de Supervivencia", col = c("red", "deepskyblue"))
lines(parametric_model_age$flex[[1]], ci = TRUE,   col = "red")
lines(parametric_model_age$flex[[2]], ci = TRUE,   col = "deepskyblue")
plot(df_km_group,  main = "Figura 9: Estimación paramétrica (distribución de Gompertz) \n y no-paramétrica de las curvas de supervivencia \n diferenciadas según el sexo", xlab = "Tiempo",
ylab = "Probabilidad de Supervivencia", col = c("black", "lightgray"))
lines(parametric_model_age$flex[[1]], ci = TRUE,   col = "black")
lines(parametric_model_age$flex[[2]], ci = TRUE,   col = "lightgray")
plot(df_km_group,  main = "Figura 9: Estimación paramétrica (distribución de Gompertz) \n y no-paramétrica de las curvas de supervivencia \n diferenciadas según el sexo", xlab = "Tiempo",
ylab = "Probabilidad de Supervivencia", col = c("black", "gray"))
lines(parametric_model_age$flex[[1]], ci = TRUE,   col = "black")
lines(parametric_model_age$flex[[2]], ci = TRUE,   col = "gray")
plot(df_km_group,  main = "Figura 9: Estimación paramétrica (distribución de Gompertz) \n y no-paramétrica de las curvas de supervivencia \n diferenciadas según el sexo", xlab = "Tiempo",
ylab = "Probabilidad de Supervivencia", col = c("black", "azure4"))
lines(parametric_model_age$flex[[1]], ci = TRUE,   col = "black")
lines(parametric_model_age$flex[[2]], ci = TRUE,   col = "azure4")
plot(df_km_group,  main = "", xlab = "Time since admission to ICU (days)",
ylab = "Survival probability", col = c("black", "azure4"))
lines(parametric_model_age$flex[[1]], ci = TRUE,   col = "black")
lines(parametric_model_age$flex[[2]], ci = TRUE,   col = "azure4")
levels(as.factor(dataset_parametric$Group_age))
legend("bottomleft", c("[18,65)", "[65,Inf]"))
legend("bottomleft", c("[18,65)", "[65,Inf]"), lty = 1:(2 + 1), col = 1:(2 + 1))
legend("bottomleft", c("[18,65)", "[65,Inf]"), col = 1:(2 + 1))
legend("bottomleft", c("[18,65)", "[65,Inf]"), lty = 1:(2 + 1), col = 1:(2 + 1))
legend("bottomleft", c("[18,65)", "[65,Inf]"), lty = 1:(2 + 1), col = c("black", "azure4"))
legend("bottomleft", c("[18,65)", "[65,Inf]"), col = c("black", "azure4"))
help(legend)
legend("bottomleft", c("[18,65)", "[65,Inf]"), lwd = 1:(2 + 1), col = c("black", "azure4"))
plot(df_km_group,  main = "", xlab = "Time since admission to ICU (days)",
ylab = "Survival probability", col = c("black", "azure4"))
help(legend)
legend("bottomleft", c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), border = "white")
plot(df_km_group,  main = "", xlab = "Time since admission to ICU (days)",
ylab = "Survival probability", col = c("black", "azure4"))
lines(parametric_model_age$flex[[1]], ci = TRUE,   col = "black")
lines(parametric_model_age$flex[[2]], ci = TRUE,   col = "azure4")
legend("bottomleft", c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), border = "white")
legend("bottomleft", c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), border = "")
legend("bottomleft", c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n")
plot(df_km_group,  main = "", xlab = "Time since admission to ICU (days)",
ylab = "Survival probability", col = c("black", "azure4"))
lines(parametric_model_age$flex[[1]], ci = TRUE,   col = "black")
lines(parametric_model_age$flex[[2]], ci = TRUE,   col = "azure4")
legend("bottomleft", c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n")
legend("topright", c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n")
plot(df_km_group,  main = "", xlab = "Time since admission to ICU (days)",
ylab = "Survival probability", col = c("black", "azure4"))
lines(parametric_model_age$flex[[1]], ci = TRUE,   col = "black")
lines(parametric_model_age$flex[[2]], ci = TRUE,   col = "azure4")
legend("topright", c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n")
plot(df_km_group,  main = "", xlab = "Time since admission to ICU (days)",
ylab = "Survival probability", col = c("black", "azure4"))
lines(parametric_model_age$flex[[1]], ci = TRUE,   col = "black")
lines(parametric_model_age$flex[[2]], ci = TRUE,   col = "azure4")
legend("topright", c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = "red")
legend("topright", c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"))
plot(df_km_group,  main = "", xlab = "Time since admission to ICU (days)",
ylab = "Survival probability", col = c("black", "azure4"))
lines(parametric_model_age$flex[[1]], ci = TRUE,   col = "black")
lines(parametric_model_age$flex[[2]], ci = TRUE,   col = "azure4")
legend( c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"))
legend("topright", c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"))
legend(2,4, c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"))
plot(df_km_group,  main = "", xlab = "Time since admission to ICU (days)",
ylab = "Survival probability", col = c("black", "azure4"))
lines(parametric_model_age$flex[[1]], ci = TRUE,   col = "black")
lines(parametric_model_age$flex[[2]], ci = TRUE,   col = "azure4")
legend(2,4, c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"))
plot(df_km_group,  main = "", xlab = "Time since admission to ICU (days)",
ylab = "Survival probability", col = c("black", "azure4"))
lines(parametric_model_age$flex[[1]], ci = TRUE,   col = "black")
lines(parametric_model_age$flex[[2]], ci = TRUE,   col = "azure4")
legend(2,4, c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"))
legend(2,4, legend = c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"))
legend("topright", legend = c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"))
legend("rigth", legend = c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"))
legend("right", legend = c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"))
plot(df_km_group,  main = "", xlab = "Time since admission to ICU (days)",
ylab = "Survival probability", col = c("black", "azure4"))
lines(parametric_model_age$flex[[1]], ci = TRUE,   col = "black")
lines(parametric_model_age$flex[[2]], ci = TRUE,   col = "azure4")
legend("right", legend = c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"))
plot(df_km_group,  main = "", xlab = "Time since admission to ICU (days)",
ylab = "Survival probability", col = c("black", "azure4"))
lines(parametric_model_age$flex[[1]], ci = TRUE,   col = "black")
lines(parametric_model_age$flex[[2]], ci = TRUE,   col = "azure4")
legend("right", legend = c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"),
horiz = TRUE)
plot(df_km_group,  main = "", xlab = "Time since admission to ICU (days)",
ylab = "Survival probability", col = c("black", "azure4"))
lines(parametric_model_age$flex[[1]], ci = TRUE,   col = "black")
lines(parametric_model_age$flex[[2]], ci = TRUE,   col = "azure4")
legend("topright", legend = c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"),
horiz = TRUE)
legend(x = 2, y = 4, legend = c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"),
horiz = TRUE)
plot(df_km_group,  main = "", xlab = "Time since admission to ICU (days)",
ylab = "Survival probability", col = c("black", "azure4"))
lines(parametric_model_age$flex[[1]], ci = TRUE,   col = "black")
lines(parametric_model_age$flex[[2]], ci = TRUE,   col = "azure4")
legend(x = 2, y = 4, legend = c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"),
horiz = TRUE)
plot(df_km_group,  main = "", xlab = "Time since admission to ICU (days)",
ylab = "Survival probability", col = c("black", "azure4"))
lines(parametric_model_age$flex[[1]], ci = TRUE,   col = "black")
lines(parametric_model_age$flex[[2]], ci = TRUE,   col = "azure4")
legend(x = 1900, y = 0.8, legend = c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"),
horiz = TRUE)
legend(x = 1900, y = 0.8, legend = c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"),
horiz = TRUE, lwd = 2)
plot(df_km_group,  main = "", xlab = "Time since admission to ICU (days)",
ylab = "Survival probability", col = c("black", "azure4"))
lines(parametric_model_age$flex[[1]], ci = TRUE,   col = "black")
lines(parametric_model_age$flex[[2]], ci = TRUE,   col = "azure4")
legend(x = 1900, y = 0.8, legend = c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"),
horiz = TRUE, lty = c(1, 2), lwd = 2)
legend(x = 1900, y = 0.8, legend = c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"),
horiz = TRUE, lty = c(1, 2))
plot(df_km_group,  main = "", xlab = "Time since admission to ICU (days)",
ylab = "Survival probability", col = c("black", "azure4"))
lines(parametric_model_age$flex[[1]], ci = TRUE,   col = "black")
lines(parametric_model_age$flex[[2]], ci = TRUE,   col = "azure4")
legend(x = 1900, y = 0.8, legend = c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"),
horiz = TRUE, lty = c(1, 2))
legend("topright", legend = c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"),
horiz = TRUE)
legend("right", legend = c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"),
horiz = TRUE)
plot(df_km_group,  main = "", xlab = "Time since admission to ICU (days)",
ylab = "Survival probability", col = c("black", "azure4"))
lines(parametric_model_age$flex[[1]], ci = TRUE,   col = "black")
lines(parametric_model_age$flex[[2]], ci = TRUE,   col = "azure4")
legend("right", legend = c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"),
horiz = TRUE)
plot(df_km_group,  main = "", xlab = "Time since admission to ICU (days)",
ylab = "Survival probability", col = c("black", "azure4"))
lines(parametric_model_age$flex[[1]], ci = TRUE,   col = "black")
lines(parametric_model_age$flex[[2]], ci = TRUE,   col = "azure4")
legend("right", legend = c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"),
horiz = TRUE)
legend("right", legend = c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"),
horiz = TRUE, inset = 0.05)
plot(df_km_group,  main = "", xlab = "Time since admission to ICU (days)",
ylab = "Survival probability", col = c("black", "azure4"))
lines(parametric_model_age$flex[[1]], ci = TRUE,   col = "black")
lines(parametric_model_age$flex[[2]], ci = TRUE,   col = "azure4")
legend("right", legend = c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"),
horiz = TRUE, inset = 0.05)
legend("topright", legend = c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"),
horiz = TRUE, inset = 0.05)
plot(df_km_group,  main = "", xlab = "Time since admission to ICU (days)",
ylab = "Survival probability", col = c("black", "azure4"))
lines(parametric_model_age$flex[[1]], ci = TRUE,   col = "black")
lines(parametric_model_age$flex[[2]], ci = TRUE,   col = "azure4")
legend("topright", legend = c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"),
horiz = TRUE, inset = 0.05)
legend("topright", legend = c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"),
horiz = TRUE, inset = 0.07)
plot(df_km_group,  main = "", xlab = "Time since admission to ICU (days)",
ylab = "Survival probability", col = c("black", "azure4"))
lines(parametric_model_age$flex[[1]], ci = TRUE,   col = "black")
lines(parametric_model_age$flex[[2]], ci = TRUE,   col = "azure4")
legend("topright", legend = c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"),
horiz = TRUE, inset = 0.07)
plot(df_km_group,  main = "", xlab = "Time since admission to ICU (days)",
ylab = "Survival probability", col = c("black", "azure4"))
lines(parametric_model_age$flex[[1]], ci = TRUE,   col = "black")
lines(parametric_model_age$flex[[2]], ci = TRUE,   col = "azure4")
legend("topright", legend = c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"),
horiz = TRUE, inset = 0.08)
parametric_model_age = dataset_parametric %>% group_by(Group_age) %>% do(flex = flexsurvreg(Surv(t_UCI, d) ~ 1, data = ., dist = "gompertz"))
df_km_group <-  survfit(Surv(t_UCI, d) ~ Group, data = dataset_parametric)
parametric_model_age = dataset_parametric %>% group_by(Group_age) %>% do(flex = flexsurvreg(Surv(t_UCI, d) ~ 1, data = ., dist = "gompertz"))
parametric_model_age$Group_age[1]
parametric_model_age$Group_age
parametric_model_age$Group_age[[1]]
parametric_model_age$Group_age$flex
parametric_model_age$Group_age[1]$flex
View(parametric_model_age)
View(parametric_model_age[[2]][[1]])
parametric_model_age[[2]][[1]]
parametric_model_age[[2]][[1]][["data"]]
parametric_model_age[[2]][[1]][["data"]][["m"]][["Surv(t_UCI, d)"]]
parametric_model_age[[2]][[1]][["data"]][["mml"]][["rate"]]
# Grupo 1
dataset_g1 = dataset_parametric %<% filter(Group_age = "[18,65)")
# Grupo 1
dataset_g1 = dataset_parametric %>% filter(Group_age = "[18,65)")
# Grupo 1
dataset_g1 = dataset_parametric %>% filter(Group_age == "[18,65)")
parametric_model_age_1 = flexsurvreg(Surv(t_UCI, d) ~ 1, data = dataset_g1, dist = "gompertz") %>% summary(type = "survival") %>% data.frame
parametric_model_age_1
parametric_model_age_1
parametric_model_age_1$est
parametric_model_age_1 = flexsurvreg(Surv(t_UCI, d) ~ 1, data = dataset_g1, dist = "gompertz")
View(parametric_model_age)
View(parametric_model_age[[2]][[1]])
x_1 = parametric_model_age[[2]][[1]]
View(x_1)
View(parametric_model_age_1)
# Grupo 1
dataset_g1 = dataset_parametric %>% filter(Group_age == "[18,65)")
dataset_g1
View(parametric_model_age)
View(parametric_model_age[[2]][[1]])
parametric_model_age[[1]]
rametric_model_age[[2]]
parametric_model_age[[2]][[1]]
parametric_model_age[[2]]
# Grupo 1
parametric_model_age_1 = parametric_model_age[[2]][[1]] %>% summary(type = "survival") %>% data.frame
# Grupo 1
parametric_model_age_1 = parametric_model_age[[2]][[1]] %>% summary(type = "survival") %>% data.frame
# Grupo 2:
parametric_model_age_2 = parametric_model_age[[2]][[2]] %>% summary(type = "survival") %>% data.frame
parametric_model_age_1
# Grupo 2:
parametric_model_age_2 = parametric_model_age[[2]][[2]] %>% summary(type = "survival") %>% data.frame
# Guardar la curva de supervivencia estimada
png(file = "Paper_resultados/Parametric_model/Output/Total/General/Curva.png",
width = 558, height = 407)
# Guardar la curva de supervivencia estimada
png(file = "Paper_resultados/Parametric_model/Survival_rate/Output/Total/Curva.png",
width = 558, height = 407)
plot(df_km_group,  main = "", xlab = "Time since admission to ICU (days)",
ylab = "Survival probability", col = c("black", "azure4"))
lines(parametric_model_age$flex[[1]], ci = TRUE,   col = "black")
lines(parametric_model_age$flex[[2]], ci = TRUE,   col = "azure4")
legend("topright", legend = c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"),
horiz = TRUE, inset = 0.08)
dev.off()
plot(df_km_group,  main = "", xlab = "Time since admission to ICU (days)",
ylab = "Survival probability", col = c("black", "azure4"))
lines(parametric_model_age$flex[[1]], ci = TRUE,   col = "black")
lines(parametric_model_age$flex[[2]], ci = TRUE,   col = "azure4")
legend("topright", legend = c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"),
horiz = TRUE, inset = 0.08)
# Guardar la curva de supervivencia estimada
png(file = "Paper_resultados/Parametric_model/Survival_rate/Output/Total/Age/Curva.png",
width = 558, height = 407)
plot(df_km_group,  main = "", xlab = "Time since admission to ICU (days)",
ylab = "Survival probability", col = c("black", "azure4"))
lines(parametric_model_age$flex[[1]], ci = TRUE,   col = "black")
lines(parametric_model_age$flex[[2]], ci = TRUE,   col = "azure4")
legend("topright", legend = c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"),
horiz = TRUE, inset = 0.08)
dev.off()
plot(df_km_group,  main = "", xlab = "Time since admission to ICU (days)",
ylab = "Survival probability", col = c("black", "azure4"))
lines(parametric_model_age$flex[[1]], ci = TRUE,   col = "black")
lines(parametric_model_age$flex[[2]], ci = TRUE,   col = "azure4")
legend("topright", legend = c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"),
horiz = TRUE, inset = 0.08)
parametric_model_age = dataset_parametric %>% group_by(Group_age) %>% do(flex = flexsurvreg(Surv(t_UCI, d) ~ 1, data = ., dist = "gompertz"))
df_km_group <-  survfit(Surv(t_UCI, d) ~ Group, data = dataset_parametric)
# Grupo 1
parametric_model_age_1 = parametric_model_age[[2]][[1]] %>% summary(type = "survival") %>% data.frame
writexl::write_xlsx(parametric_model_age_1,
"Paper_resultados/Parametric_model/Survival_rate/Output/Total/Age/Outcome_g1.xlsx")
# Grupo 2:
parametric_model_age_2 = parametric_model_age[[2]][[2]] %>% summary(type = "survival") %>% data.frame
writexl::write_xlsx(parametric_model_age_2,
"Paper_resultados/Parametric_model/Survival_rate/Output/Total/Age/Outcome_g2.xlsx")
# Guardar la curva de supervivencia estimada
png(file = "Paper_resultados/Parametric_model/Survival_rate/Output/Total/Age/Curva.png",
width = 558, height = 407)
plot(df_km_group,  main = "", xlab = "Time since admission to ICU (days)",
ylab = "Survival probability", col = c("black", "azure4"))
lines(parametric_model_age$flex[[1]], ci = TRUE,   col = "black")
lines(parametric_model_age$flex[[2]], ci = TRUE,   col = "azure4")
legend("topright", legend = c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"),
horiz = TRUE, inset = 0.08)
dev.off()
plot(df_km_group,  main = "", xlab = "Time since admission to ICU (days)",
ylab = "Survival probability", col = c("black", "azure4"))
lines(parametric_model_age$flex[[1]], ci = TRUE,   col = "black")
lines(parametric_model_age$flex[[2]], ci = TRUE,   col = "azure4")
legend("topright", legend = c("[18,65)", "[65,Inf]"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"),
horiz = TRUE, inset = 0.08)
parametric_model_CCI = dataset_parametric %>% group_by(CCI) %>% do(flex = flexsurvreg(Surv(t_UCI, d) ~ 1, data = ., dist = "gompertz"))
df_km_group <-  survfit(Surv(t_UCI, d) ~ CCI, data = dataset_parametric)
parametric_model_CCI[[2]]
parametric_model_CCI
dplyr::count(dataset_parametric$CCI)
dplyr::count(as.factor(dataset_parametric$CCI))
dplyr::count(dataset_parametric$CCI)
count(as.factor(dataset_parametric$CCI))
# Grupo 1
parametric_model_CCI = parametric_model_age[[2]][[1]] %>% summary(type = "survival") %>% data.frame
parametric_model_status = dataset_parametric %>% group_by(CCI) %>% do(flex = flexsurvreg(Surv(t_UCI, d) ~ 1, data = ., dist = "gompertz"))
df_km_group <-  survfit(Surv(t_UCI, d) ~ CCI, data = dataset_parametric)
parametric_model_status
parametric_model_status[[2]]
# Grupo 1
parametric_model_CCI = parametric_model_age[[2]][[1]] %>% summary(type = "survival") %>% data.frame
# Grupo 1
parametric_model_CCI = parametric_model_status[[2]][[1]] %>% summary(type = "survival") %>% data.frame
writexl::write_xlsx(parametric_model_CCI,
"Paper_resultados/Parametric_model/Survival_rate/Output/Total/CCI/Outcome_CCI.xlsx")
# Grupo 2:
parametric_model_non_CCI = parametric_model_status[[2]][[2]] %>% summary(type = "survival") %>% data.frame
writexl::write_xlsx(parametric_model_non_CCI,
"Paper_resultados/Parametric_model/Survival_rate/Output/Total/Age/Outcome_Non_CCI.xlsx")
writexl::write_xlsx(parametric_model_non_CCI,
"Paper_resultados/Parametric_model/Survival_rate/Output/Total/CCI/Outcome_Non_CCI.xlsx")
legend("topright", legend = c("CCI", "Non-CCI"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"),
horiz = TRUE, inset = 0.08)
plot(df_km_group,  main = "", xlab = "Time since admission to ICU (days)",
ylab = "Survival probability", col = c("black", "azure4"))
lines(parametric_model_age$flex[[1]], ci = TRUE,   col = "black")
lines(parametric_model_age$flex[[2]], ci = TRUE,   col = "azure4")
legend("topright", legend = c("CCI", "Non-CCI"),
lwd = 1:(2 + 1),
col = c("black", "azure4"), bty = "n", fill = c("black","azure4"),
horiz = TRUE, inset = 0.08)
CCI = dataset %>$ filter(CCI = "CCI")
CCI = dataset %>% filter(CCI = "CCI")
CCI = dataset %>% filter(CCI == "CCI")
CCI = dataset %>% filter(CCI == "CCI")
CCI_parametric = flexsurvreg(Surv(t_UCI, d) ~ 1, data = dataset, dist = "gompertz")
CCI_parametric
CCI_parametric = flexsurvreg(Surv(t_UCI, d) ~ 1, data = dataset, dist = "gompertz") %>% summary(type = "survival") %>% data.frame
x =  c(1,2,3,4,5,6,7,8)
y = c(7,8,9,10,11,12)
z =  c(7,8,13,14,15)
myl = list(x,y,z)
lapply(1:length(myl), function(n) setdiff(myl[n], unlist(myl[-n])))
setdiff(x,y,z)
unlist(myl[1])
lapply(1:length(myl), function(n) setdiff(myl[n], unlist(myl[-n])))
myl = list(A = x,B = y,C = z)
lapply(1:length(myl), function(n) setdiff(myl[n], unlist(myl[-n])))
diffs = Reduce(setdiff, list(A = x,B = y,C = z))
diffs
y = c("mnu", "erd", "usd", "ml")
z =  c("ssu", "erd", "usd", "ml")
myl = list(A = x,B = y,C = z)
lapply(1:length(myl), function(n) setdiff(myl[n], unlist(myl[-n])))
x =  c("osa", "bli", "usd", "ml")
y = c("mnu", "erd", "usd", "ml")
z =  c("ssu", "erd", "usd", "ml")
myl = list(A = x,B = y,C = z)
lapply(1:length(myl), function(n) setdiff(myl[n], unlist(myl[-n])))
lapply(1:length(myl), function(n) setdiff(myl[[n]], unlist(myl[-n])))
x =  c("osa", "bli", "usd", "ml")
y = c("mnu", "erd", "usd", "ml")
z =  c("ssu", "erd", "usd", "ml")
myl = list(A = x,B = y,C = z)
lapply(1:length(myl), function(n) setdiff(myl[[n]], unlist(myl[-n])))
