setwd("~/Desktop/Proyecto_Long_COVID")
###############################
## Primer borrador: análisis ##
##     de distribución       ##
###############################
source(here::here("Paper_resultados/Descriptive_analysis/05_Chi_2_Fisher/",
"Fisher_test.R"))
############################################
## Modelo paramétrico gamma generalizado  ##
############################################
flexg_gamma <- flexsurvreg(Surv(t_UCI, d) ~ 1,
data = dataset,
dist = "GenGamma.orig") %>% summary(type = "survival") %>% data.frame
library(here)
library(survival)
library(KMsurv)
library(survMisc)
library(survminer)
library(ggfortify)
library(flexsurv)
library(actuar)
library(tidyverse)
library(dplyr)
library(ggplot2)
library(readxl)
library(xts)
library(plyr)
library(dplyr)
library(writexl)
library(knitr)
library(moments)
library(fitdistrplus)
library(logspline)
############################################
## Modelo paramétrico gamma generalizado  ##
############################################
flexg_gamma <- flexsurvreg(Surv(t_UCI, d) ~ 1,
data = dataset,
dist = "GenGamma.orig") %>% summary(type = "survival") %>% data.frame
non_par <- survfit(Surv(t_UCI, d) ~ 1, data = dataset) %>% fortify
dist <- c("weibull", "lnorm", "GenGamma.orig", "llogis", "gompertz")
data.Surv <- Surv(dataset$t_UCI, dataset$d)
modelo_general <- sapply(dist, function(x) flexsurvreg(data.Surv ~ 1, dist = x), USE.NAMES = T, simplify = F)
plot(modelo_general[[1]], ci = F, conf.int = F, lty = 2,
main = "Figura 28: ajuste Paramétrico",
xlab = "Tiempo", ylab = "Probabilidad de Supervivencia")
for (i in 2:length(dist)) plot(modelo_general[[i]], ci = F, conf.int = F, add = T, col = i + 1, lty = i)
plot(modelo_general[[1]], ci = F, conf.int = F, lty = 2,
main = "Figura 28: ajuste Paramétrico",
xlab = "Tiempo", ylab = "Probabilidad de Supervivencia")
for (i in 2:length(dist)) plot(modelo_general[[i]], ci = F, conf.int = F, add = T, col = i + 1, lty = i)
legend("topright", c("Kaplan-Meier", "Weibull", "Log-Normal","Gamma generalizada",
"Log-logística", "Gompertz"), lty = 1:(length(dist) + 1), col = 1:(length(dist) + 1))
dist <- c("weibull", "lnorm", "GenGamma.orig", "llogis", "gompertz", "exp")
data.Surv <- Surv(dataset$t_UCI, dataset$d)
modelo_general <- sapply(dist, function(x) flexsurvreg(data.Surv ~ 1, dist = x), USE.NAMES = T, simplify = F)
plot(modelo_general[[1]], ci = F, conf.int = F, lty = 2,
main = "Figura 28: ajuste Paramétrico",
xlab = "Tiempo", ylab = "Probabilidad de Supervivencia")
for (i in 2:length(dist)) plot(modelo_general[[i]], ci = F, conf.int = F, add = T, col = i + 1, lty = i)
legend("topright", c("Kaplan-Meier", "Weibull", "Log-Normal","Gamma generalizada",
"Log-logística", "Gompertz", "Exponencial"), lty = 1:(length(dist) + 1), col = 1:(length(dist) + 1))
dist <- c("weibull", "lnorm", "GenGamma.orig", "llogis", "gompertz", "exp")
data.Surv <- Surv(dataset$t_UCI, dataset$d)
modelo_general <- sapply(dist, function(x) flexsurvreg(data.Surv ~ 1, dist = x), USE.NAMES = T, simplify = F)
plot(modelo_general[[1]], ci = F, conf.int = F, lty = 2,
main = "Figura 28: ajuste Paramétrico",
xlab = "Tiempo", ylab = "Probabilidad de Supervivencia")
for (i in 2:length(dist)) plot(modelo_general[[i]], ci = F, conf.int = F, add = T, col = i + 1, lty = i)
legend("belowright", c("Kaplan-Meier", "Weibull", "Log-Normal","Gamma generalizada",
"Log-logística", "Gompertz", "Exponencial"), lty = 1:(length(dist) + 1), col = 1:(length(dist) + 1))
legend("bottomright", c("Kaplan-Meier", "Weibull", "Log-Normal","Gamma generalizada",
"Log-logística", "Gompertz", "Exponencial"), lty = 1:(length(dist) + 1), col = 1:(length(dist) + 1))
plot(modelo_general[[1]], ci = F, conf.int = F, lty = 2,
main = "Figura 28: ajuste Paramétrico",
xlab = "Tiempo", ylab = "Probabilidad de Supervivencia")
for (i in 2:length(dist)) plot(modelo_general[[i]], ci = F, conf.int = F, add = T, col = i + 1, lty = i)
legend("bottomright", c("Kaplan-Meier", "Weibull", "Log-Normal","Gamma generalizada",
"Log-logística", "Gompertz", "Exponencial"), lty = 1:(length(dist) + 1), col = 1:(length(dist) + 1))
data_surv <- Surv(dataset$t_UCI, dataset$d)
modelo <- sapply(dist,
function(x) flexsurvreg(data_surv ~ 1, data = dataset, dist = x),
USE.NAMES = T, simplify = F)
IC_model <- sapply(modelo, function(x) c(AIC = AIC(x), BIC = BIC(x), LogLik = logLik(x)), simplify = T)
IC_model[, order(IC_model["AIC", ])]
kable(IC_model, caption = "Tabla 13: Criterios de información", col.names = c("Gamma generalizada", "Weibull", "Gompertz", "Log-Normal", "Log-Logística"))
IC_model
IC_model
modelo_general[[1]]
############################################
## Modelo paramétrico gamma generalizado  ##
############################################
flexg_gamma <- flexsurvreg(Surv(t_UCI, d) ~ 1,
data = dataset,
dist = "GenGamma.orig") %>% summary(type = "survival") %>% data.frame
non_par <- survfit(Surv(t_UCI, d) ~ 1, data = dataset) %>% fortify
# Curva de supervivencia
ggplot() + geom_line(aes(time, est, col = "Paramétrico (Gamma generalizada)"),
data = flexg_gamma) + geom_step(aes(time,
surv, col = "No Paramétrico"), data =non_par) + labs(x = "Tiempo (Días)",
y = "Probabilidad de Supervivencia", col = "Ajustes",
title = "Figura 7: Estimación paramétrica y no-paramétrica de la función de supervivencia")
flexg_gamma <- flexsurvreg(Surv(t_UCI, d) ~ 1,
data = dataset,
dist = "GenGamma.orig") %>% summary(type = "survival") %>% data.frame
non_par <- survfit(Surv(t_UCI, d) ~ 1, data = dataset) %>% fortify
# Curva de supervivencia
ggplot() + geom_line(aes(time, est, col = "Paramétrico (Gamma generalizada)"),
data = flexg_gamma) + geom_step(aes(time,
surv, col = "No Paramétrico"), data =non_par) + labs(x = "Tiempo (Días)",
y = "Probabilidad de Supervivencia", col = "Ajustes",
title = "Figura 7: Estimación paramétrica y no-paramétrica de la función de supervivencia")
# Función de riesgo acumulada
ggplot() + geom_line(aes(time, -log(est), col = "Paramétrico (Gamma generalizada)"), data = flexg_gamma) + geom_step(aes(time, -log(surv), col = "No-paramétrico"), data = non_par) +
labs(x = "Tiempo (Días)",
y = "Riesgo Acumulado", col = "Ajustes", title = "Figura 8: Estimación paramétrica y no-paramétrica de la función de riesgo acumulado")
#######################################
## Modelo paramétrico log-logística  ##
#######################################
flexg_loglogis <- flexsurvreg(Surv(t_UCI, d) ~ 1,
data = dataset, dist = "llogis") %>%
summary(type = "survival") %>% data.frame
# Curva de supervivencia
ggplot() + geom_line(aes(time, est, col = "Paramétrico (Log-logística)"),
data = flexg_loglogis) + geom_step(aes(time,
surv, col = "No-paramétrico"),
data =non_par) + labs(x = "Tiempo (Días)",
y = "Probabilidad de Supervivencia", col = "Ajustes")
# Función de riesgo acumulado
ggplot() + geom_line(aes(time, -log(est), col = "Paramétrico (Log-logística)"), data = flexg_loglogis) +
geom_step(aes(time, -log(surv), col = "No-paramétrico"), data = non_par) +
labs(x = "Tiempo (Días)", y = "Riesgo Acumulado", col = "Ajustes")
#######################################
## Modelo paramétrico de Gompertz    ##
#######################################
flexg_gompertz <- flexsurvreg(Surv(t_UCI, d) ~ 1, data = dataset, dist = "gompertz") %>% summary(type = "survival") %>% data.frame
# Curva de supervivencia
ggplot() + geom_line(aes(time, est, col = "Parametric model (Gompertz)"),
data = flexg_gompertz) + geom_step(aes(time,
surv, col = "Kaplan-Meier estimator"),
data =non_par) + labs(x = "Time since admission to ICU (days)",
y = "Survival probability",
col = "")
# Función de riesgo acumulado
ggplot() + geom_line(aes(time, -log(est), col = "Paramétrico (Gompertz)"), data = flexg_gompertz) +
geom_step(aes(time, -log(surv), col = "No-paramétrico"), data = non_par) +
labs(x = "Tiempo (Días)", y = "Riesgo Acumulado", col = "Ajustes")
#######################################
## Modelo paramétrico exponencial    ##
#######################################
flexg_exp <- flexsurvreg(Surv(t_UCI, d) ~ 1, data = dataset, dist = "exp") %>% summary(type = "survival") %>% data.frame
# Curva de supervivencia
ggplot() + geom_line(aes(time, est, col = "Parametric model (Exponential)"),
data = flexg_exp) + geom_step(aes(time,
surv, col = "Kaplan-Meier estimator"),
data =non_par) + labs(x = "Time since admission to ICU (days)",
y = "Survival probability",
col = "")
# Función de riesgo acumulado
ggplot() + geom_line(aes(time, -log(est), col = "Paramétrico (Exponential)"), data = flexg_exp) +
geom_step(aes(time, -log(surv), col = "No-paramétrico"), data = non_par) +
labs(x = "Tiempo (Días)", y = "Riesgo Acumulado", col = "Ajustes")
#######################################
## Modelo paramétrico log normal     ##
#######################################
flexg_lnorm <- flexsurvreg(Surv(t_UCI, d) ~ 1, data = dataset, dist = "lnorm") %>% summary(type = "survival") %>% data.frame
# Curva de supervivencia
ggplot() + geom_line(aes(time, est, col = "Parametric model (Log-Normal)"),
data = flexg_lnorm) + geom_step(aes(time,
surv, col = "Kaplan-Meier estimator"),
data =non_par) + labs(x = "Time since admission to ICU (days)",
y = "Survival probability",
col = "")
# Función de riesgo acumulado
ggplot() + geom_line(aes(time, -log(est), col = "Paramétrico (Log-Normal)"), data = flexg_lnorm) +
geom_step(aes(time, -log(surv), col = "No-paramétrico"), data = non_par) +
labs(x = "Tiempo (Días)", y = "Riesgo Acumulado", col = "Ajustes")
flexg_exp
flexg_gamma
comparar = merge(flexg_gamma[c("time", "est")], flexg_gompertz["time", "est"], by = "time")
comparar = merge(flexg_gamma[c("time", "est")], flexg_gompertz[c("time", "est")], by = "time")
View(comparar)
# log-logis
loglogis = flexg_loglogis[c("time","est")]
# log-logis
loglogis = flexg_loglogis[c("time","est")]
colnames(loglogis) = c("time", "loglogis")
comparar = merge(gamma, gompertz, by = "time")
################################################
## Comparación de las tasas de supervivencia  ##
##    (Salida de los modelos paramétricos)    ##
################################################
# gamma
gamma = flexg_gamma[c("time", "est")]
################################################
## Comparación de las tasas de supervivencia  ##
##    (Salida de los modelos paramétricos)    ##
################################################
# gamma
gamma_model = flexg_gamma[c("time", "est")]
colnames(gamma_model) = c("time", "gamma")
# gompertz
gompertz_model = flexg_gompertz[c("time", "est")]
colnames(gompertz_model) = c("time", "gompertz")
# exponencial
exp_model = flexg_exp[c("time","est")]
colnames(exp_model) = c("time", "exp")
# log-normal
lognormal_model = flexg_lnorm[c("time","est")]
colnames(lognormal_model) = c("time", "lnormal")
# log-logis
loglogis_model = flexg_loglogis[c("time","est")]
colnames(loglogis_model) = c("time", "loglogis")
comparar = merge(gamma_model, gompertz_model, by = "time")
comparar = merge(comparar, exp_model, by = "time")
comparar = merge(comparar, lognormal_model, by = "time")
comparar = merge(comparar, loglogis_model, by ="time")
View(comparar)
non_par
#######################################
## Modelo paramétrico Weibull        ##
#######################################
flexg_weibull <- flexsurvreg(Surv(t_UCI, d) ~ 1, data = dataset, dist = "weibull") %>% summary(type = "survival") %>% data.frame
# Curva de supervivencia
ggplot() + geom_line(aes(time, est, col = "Parametric model (Weibull)"),
data = flexg_lnorm) + geom_step(aes(time,
surv, col = "Kaplan-Meier estimator"),
data =non_par) + labs(x = "Time since admission to ICU (days)",
y = "Survival probability",
col = "")
# Función de riesgo acumulado
ggplot() + geom_line(aes(time, -log(est), col = "Paramétrico (Weibull)"), data = flexg_lnorm) +
geom_step(aes(time, -log(surv), col = "No-paramétrico"), data = non_par) +
labs(x = "Tiempo (Días)", y = "Riesgo Acumulado", col = "Ajustes")
# weibull
weibull_model = flexg_weibull[c("time","est")]
colnames(weibull_model) = c("time", "weibull")
comparar = merge(comparar, weibull_model, by = "time")
View(comparar)
